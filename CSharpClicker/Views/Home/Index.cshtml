@using CSharpClicker.DomainServices
@using CSharpClicker.Helpers
@model IndexViewModel

@section styles {
    <link href="~/css/index.css" rel="stylesheet">
}

@section scripts {
    <script src="~/js/index.js" asp-append-version="true"></script>
}

<div class="game-wrapper">
    <aside class="sidebar-left">
        <div class="user-card card-panel">
            <div class="avatar-circle">
                <i class="fas fa-user-astronaut"></i>
            </div>
            <h3>@Model.UserInfo.UserName</h3>
            <div class="score-display">
                <span class="score-label">Золото</span>
                <span id="currentScore" class="score-value" data-val="@Model.UserInfo.CurrentScore">
                    @Model.UserInfo.CurrentScore.ToCompact()
                </span>
            </div>
            <div class="score-sub">
                Всего добыто:
                <span id="recordScore" data-val="@Model.UserInfo.RecordScore">
                    @Model.UserInfo.RecordScore.ToCompact()
                </span>
            </div>

            <a href="/Home/Leaderboard" class="btn-leaderboard">
                <i class="fas fa-trophy"></i> Таблица лидеров
            </a>

            <form asp-controller="Auth" asp-action="Logout" method="post" class="mt-3 w-100">
                <button type="submit" class="btn-logout">Выйти</button>
            </form>
        </div>

        <div class="stats-card card-panel">
            <h4><i class="fas fa-chart-line"></i> Статистика</h4>
            <div class="stat-row">
                <span>За клик:</span>
                <span class="stat-value text-gold">
                    +<span id="profitPerClick">@Model.UserInfo.ProfitPerClick.ToCompact()</span> <i class="fas fa-coins"></i>
                </span>
            </div>
            <div class="stat-row">
                <span>В секунду:</span>
                <span class="stat-value text-blue">
                    +<span id="profitPerSecond">@Model.UserInfo.ProfitPerSecond.ToCompact()</span> <i class="fas fa-bolt"></i>
                </span>
            </div>
        </div>
    </aside>

    <main class="main-area">
        <div class="clicker-zone">
            <div class="glow-effect"></div>

            <button id="click-item" class="clicker-btn">
            </button>
            <div class="click-instruction">Кликай, чтобы добывать золото!</div>
        </div>
    </main>

    <aside class="sidebar-right">
        <div class="shop-header">
            <h3><i class="fas fa-shopping-cart"></i> Магазин</h3>
        </div>
        <div class="boosts-list custom-scroll">
            @foreach (var boost in Model.Boosts)
            {
                var userBoost = Model.UserInfo.UserBoosts.FirstOrDefault(ub => ub.BoostId == boost.Id);
                var imgSrc = $"data:image/png;base64,{Convert.ToBase64String(boost.Image)}";

                var currentQuantity = userBoost != null ? userBoost.Quantity : 0;
                var currentPrice = userBoost != null ? userBoost.CurrentPrice : boost.Price;
                var actualProfit = UserBoostsExtensions.CalculateIncomeGain(boost.Profit, currentQuantity);

                <div data-boost-id="@boost.Id" class="boost-card">
                    <div class="boost-image">
                        <img src="@imgSrc" alt="@boost.Title" />
                    </div>
                    <div class="boost-info">
                        <div class="boost-top">
                            <h5 class="boost-title">@boost.Title</h5>
                            <div class="boost-badge">
                                x<span data-boost-quantity>@currentQuantity</span>
                            </div>
                        </div>
                        <div class="boost-profit-info">
                            <i class="fas @(boost.IsAuto ? "fa-clock" : "fa-mouse-pointer")"></i>
                            +<span data-boost-profit>@actualProfit.ToCompact()</span> @(boost.IsAuto ? "/сек" : "/клик")
                        </div>
                    </div>
                    <button class="buy-boost-button">
                        <span class="price-label">Купить за</span>
                        <span class="price-val" data-boost-price="@currentPrice">
                            @currentPrice.ToCompact()
                        </span>
                        <i class="fas fa-coins"></i>
                    </button>
                </div>
            }
        </div>
    </aside>
</div>